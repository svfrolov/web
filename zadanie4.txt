# Шпаргалка по лабораторной работе 4
## Цель работы: Завершение бэкенда для SPA

### Что мы уже сделали:
1. **Настроили Redis для хранения сессий**:
   - Создали docker-compose.yml с конфигурацией Redis
   - Запустили Redis: `docker-compose up -d`
   - Проверили, что Redis работает: `docker exec -it redis_cache redis-cli ping`
   - Сессии хранятся в базе данных Redis с индексом 1

2. **Проверили аутентификацию**:
   - Успешно вошли через Swagger UI (POST /api/users/login/)
   - Получили ответ: {"success": true, "message": "Успешная аутентификация"}

3. **Настроили Swagger документацию**:
   - API-методы имеют документацию
   - Swagger UI настроен и доступен

### Что нужно проверить согласно заданию:

1. **Аутентификация и авторизация**:
   - ✅ Выполнить метод аутентификации через swagger в режиме инкогнито
   - ✅ Получить список заявок в swagger
   - Использовать содержимое куки из вкладки Application для запросов через insomnia/postman

2. **Разграничение прав доступа**:
   - GET списка заявок:
     - Для гостя: проверить статус 401/403
     - Для создателя: проверить, что видны только его заявки
     - Для модератора: проверить доступ ко всем заявкам
   
   - PUT завершения заявки:
     - Для создателя: проверить статус 403
     - Для модератора: проверить успешное завершение и обновление полей

3. **Автозаполнение пользователя**:
   - Создать заявку и проверить, что поле creator заполнено автоматически

4. **Бизнес-процесс для Sequence диаграммы**:
   - Аутентификация
   - Получение списка услуг
   - GET пустой иконки корзины
   - Добавление услуги в заявку
   - GET иконки корзины
   - Просмотр черновой заявки
   - Редактирование заявки
   - Формирование заявки
   - Список заявок
   - Завершение модератором из второго фронтенда
   - Список заявок с расчетом

### Команды для работы с Redis:
```
# Проверка ключей в базе данных Redis с индексом 1
docker exec -it redis_cache redis-cli -n 1 KEYS *

# Получение содержимого сессии
docker exec -it redis_cache redis-cli -n 1 GET "ключ_сессии"
```

### API-запросы для проверки:
1. **Создание заявки**:
   - POST /api/supervisions/ с данными: {"construction_type": "Реконструкция"}

2. **Работа с услугами**:
   - Получить список услуг: GET /api/services/
   - Добавить услугу: POST /api/supervisions/add-service/ с данными: {"building_object_id": ID_услуги}

3. **Управление заявками**:
   - Формирование заявки: PUT /api/supervisions/{id}/submit/
   - Завершение заявки: PUT /api/supervisions/{id}/complete/
   - Выход из системы: POST /api/users/logout/

### Дополнительные задачи:
1. **Создание Sequence диаграммы в StarUML**:
   - Добавить домены в качестве Lifeline
   - Выбирать методы доменов из диаграммы классов
   - Передавать ключевые входные и выходные данные через arguments в скобках у Message
   - Использовать свойство signature из диаграммы классов

2. **Подготовка скриншотов для ТЗ по 2025 году**

### Контрольные вопросы:
- Куки
- Сессия
- Redis
- JWT
- Авторизация и аутентификация
- SSO
- Двухфакторная аутентификация
- RSA